graph TD
    Start([Start]) --> func[handleAndroidRequest] --> Branch{データ内容判定}
    
    %% サインアップ
    Branch -->|user_id, kamei_id, name, passあり| Signup[registerUser関数]
    Signup --> Exist{ID重複チェック}
    Exist -->|重複| S_False[submit: falseを返す]
    Exist -->|新規| S_Insert[acountにユーザ情報をINSERT]
    S_Insert --> S_True[submit: trueを返す]
    
    %% ログイン
    Branch -->|user_id, passあり| Login[authenticateUser関数]
    Login --> Auth{SELECT照合}
    Auth -->|不一致| L_False[login: falseを返す]
    Auth -->|一致| L_Sub[所属科目リスト取得]
    L_Sub --> L_True[login: true + 科目データを返す]
    
    %% 出席
    Branch -->|status, room等あり| Att[processAttendance関数]
    Att --> St{status >= 3?}
    St -->|Yes: 退室| Out[handleCheckout関数:<br> stu_recordに退出記録をUPDATE]
    St -->|No: 入室| In[handleCheckin関数:<br> stu_recordに出席記録をINSERT実行]
    
    Out --> Count{stu_recordへの影響行数 > 0?}
    In --> Count
    Count -->|Yes| UpCount[updateRoomCount関数: 人数加減算]
    Count -->|No| Ret[結果を返却]
    UpCount --> Ret

    S_False --> End([End])
    S_True --> End
    L_False --> End
    L_True --> End
    Ret --> End